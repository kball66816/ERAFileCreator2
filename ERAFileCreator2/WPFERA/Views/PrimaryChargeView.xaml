<UserControl x:Class="EraView.Views.PrimaryChargeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:EraView.Views"
             xmlns:common="clr-namespace:Common.Common;assembly=Common.Common"
             xmlns:viewModel="clr-namespace:PatientManagement.ViewModel;assembly=PatientManagement.ViewModel"
             mc:Ignorable="d">
    <UserControl.DataContext>
        <viewModel:PrimaryChargeViewModel/>
    </UserControl.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
            <RowDefinition />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition />
            <ColumnDefinition />
            <ColumnDefinition />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <TextBlock Text="Patient Encounters" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="4" FontSize="16" TextDecorations="Underline"
                   Margin="10,0,0,0"/>
        <StackPanel Grid.Row="1" Grid.Column="0">
            <TextBlock Name="DateOfServiceTag"
                       Margin="10,0,0,0"
                       VerticalAlignment="Top"
                       Text="Date Of Service*"/>
            <DatePicker Name="DateofServiceInput"
                        Margin="10,10,0,0"
                        SelectedDate="{Binding SelectedCharge.DateOfService}"
                        Width="115"
                        HorizontalAlignment="Left"/>
        </StackPanel>
        <StackPanel Orientation="Vertical" Grid.Row="1" Grid.Column="1" Height="55" VerticalAlignment="Top">
            <TextBlock Name="PlaceofServiceTag"
                       Margin="10,0,0,0"
                       VerticalAlignment="Top"
                       Text="Place Of Service*"/>
            <ComboBox  Name="PlaceOfServiceComboBox" ItemsSource="{Binding PlacesOfService}"
                       Margin="10,10,0,0"                 
                       DisplayMemberPath="Key"
                       SelectedValuePath="Key"
                       SelectedValue="{Binding SelectedCharge.PlaceOfService.ServiceLocation}"
                       MinWidth="115"
                       MaxWidth="115"
                       HorizontalAlignment="Left" Width="115" SelectedIndex="9" 
                       ToolTip="{Binding SelectedItem.Value, ElementName=PlaceOfServiceComboBox, Mode=OneWay}"/>

        </StackPanel>
        <StackPanel Grid.Row="1" Grid.Column="2">
            <TextBlock x:Name="BillIdTag"
                       Text="Bill ID*"
                       Margin="10,0,0,0"
                       VerticalAlignment="Top"/>
            <TextBox x:Name="BillIdInput"
                     Margin="10,10,0,0"
                     Width="115"
                     HorizontalAlignment="Left">
                <Validation.ErrorTemplate>
                    <ControlTemplate>
                        <DockPanel >
                            <Border BorderBrush="Red" BorderThickness="2">
                                <AdornedElementPlaceholder/>
                            </Border>
                        </DockPanel>
                    </ControlTemplate>
                </Validation.ErrorTemplate>
                <Binding Path="SelectedCharge.BillId" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules>
                        <common:StringValidationRule ValidationStep="RawProposedValue"/>
                    </Binding.ValidationRules>
                </Binding>
            </TextBox>
        </StackPanel>
        <StackPanel Grid.Row="1" Grid.Column="3">
            <TextBlock x:Name="PatientCopayTag"
                       VerticalAlignment="Top"
                       Margin="10,0,0,0"
                       Text="Patient's Copay*"/>
            <TextBox Name="PatientCopayInput"
                     Margin="10,10,0,0"
                     Width="115"
                     HorizontalAlignment="Left"
                     Text="{Binding SelectedCharge.Copay, Mode=TwoWay, StringFormat=\{0:F2\}, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center">
                <Validation.ErrorTemplate>
                    <ControlTemplate>
                        <DockPanel >
                            <Border BorderBrush="Red" BorderThickness="2">
                                <AdornedElementPlaceholder/>
                            </Border>
                        </DockPanel>
                    </ControlTemplate>
                </Validation.ErrorTemplate>
            </TextBox>
        </StackPanel>

        <StackPanel Grid.Column="4" Margin="0,30,0,0" Orientation="Vertical" Grid.Row="1">
            <StackPanel.DataContext>
                <viewModel:PreferenceViewModel/>
            </StackPanel.DataContext>

            <CheckBox Content="Use Current Code as Default"
                      IsChecked="{Binding Preference.ReuseLastChargeForNextPatient}"
                      Command="{Binding SavePreferenceCommand}"
                      HorizontalAlignment="Left"
                      VerticalAlignment="Center"/>

        </StackPanel>

        <TextBlock Name="PrimaryProcedureCodeTag" Grid.Row="2" Grid.Column="0"
                   Margin="10,0,0,0"
                   Text="Primary Procedure Code*"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Top" Width="127"/>
        <TextBox Name="PrimaryProcedureCodeInput" Grid.Row="2" Grid.Column="0"
                 Width="115"
                 Margin="10,20,0,0"
                 HorizontalAlignment="Left" >
            <Validation.ErrorTemplate>
                <ControlTemplate>
                    <DockPanel >
                        <Border BorderBrush="Red" BorderThickness="2">
                            <AdornedElementPlaceholder/>
                        </Border>
                    </DockPanel>
                </ControlTemplate>
            </Validation.ErrorTemplate>
            <Binding Path="SelectedCharge.ProcedureCode" UpdateSourceTrigger="PropertyChanged"  Mode="TwoWay">
                <Binding.ValidationRules>
                    <common:StringValidationRule ValidationStep="RawProposedValue"/>
                </Binding.ValidationRules>
            </Binding>
        </TextBox>
        <TextBlock Name="PrimaryModifiersTag" Grid.Row="2" Grid.Column="1"
                   Text="Modifiers"
                   Margin="10,0,0,0"
                   VerticalAlignment="Top"/>
        <StackPanel Orientation="Horizontal" Grid.Row="2" Grid.Column="1"
                    Margin="10,20,0,0"
                    HorizontalAlignment="Left" Width="115" DataContext="{Binding SelectedCharge.Modifier}">
            <TextBox x:Name="PrimaryModifierOneInput"
                     Text="{Binding ModifierOne, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     Width="25"
                     MaxLength="2"/>
            <TextBox x:Name="PrimaryModifierTwoInput"
                     Text="{Binding ModifierTwo}"
                     Width="25"
                     MaxLength="2"
                     Margin="5,0,0,0"/>
            <TextBox x:Name="PrimaryModifierThreeInput"
                     Text="{Binding ModifierThree}"
                     Width="25"
                     MaxLength="2"
                     Margin="5,0,0,0"/>
            <TextBox x:Name="PrimaryModifierFourInput"
                     Text="{Binding ModifierFour}"
                     Width="25"
                     MaxLength="2"
                     Margin="5,0,0,0"/>
        </StackPanel>
        <TextBlock Name="PrimaryPaidAmountTag" Grid.Row="2" Grid.Column="2"
                   Margin="10,0,0,0"
                   VerticalAlignment="Top"
                   Text="Primary Paid Amount*"/>
        <TextBox Name="PrimaryPaidAmountInput" Grid.Row="2" Grid.Column="2"
                 Margin="10,20,0,0"
                 Width="115"
                 HorizontalAlignment="Left"
                 Text="{Binding SelectedCharge.PaymentAmount, StringFormat=\{0:F2\}}">
            <Validation.ErrorTemplate>
                <ControlTemplate>
                    <DockPanel >
                        <Border BorderBrush="Red" BorderThickness="2">
                            <AdornedElementPlaceholder/>
                        </Border>
                    </DockPanel>
                </ControlTemplate>
            </Validation.ErrorTemplate>
        </TextBox>
        <TextBlock Name ="PrimaryChargesAmountTag" Grid.Row="2" Grid.Column="3"
                   Margin="10,0,0,0"
                   VerticalAlignment="Top"
                   Text="Primary Charge Amount*"/>
        <TextBox Name="PrimaryChargesAmountInput" Grid.Row="2" Grid.Column="3"
                 Margin="10,20,0,0"
                 Width="115"
                 HorizontalAlignment="Left"
                 Text="{Binding SelectedCharge.ChargeCost, Mode=TwoWay, StringFormat=\{0:F2\}, UpdateSourceTrigger=PropertyChanged}"
        >
            <Validation.ErrorTemplate>
                <ControlTemplate>
                    <DockPanel >
                        <Border BorderBrush="Red" BorderThickness="2">
                            <AdornedElementPlaceholder/>
                        </Border>
                    </DockPanel>
                </ControlTemplate>
            </Validation.ErrorTemplate>
        </TextBox>
        <Button Grid.Row="2" Grid.Column="4"
                Name="AddChargeToPatient"
                Command="{Binding AddChargeToPatientCommand}"
                Content="Add Charge"
                Width="115"
                Margin="10,10,0,0"
                VerticalAlignment="Bottom"
                HorizontalAlignment="left"/>
    </Grid>
</UserControl>
